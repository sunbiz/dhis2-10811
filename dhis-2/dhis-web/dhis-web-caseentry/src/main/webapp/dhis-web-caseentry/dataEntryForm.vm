<script>
	jQuery("#entryFormContainer").ready(function(){
		#if($!programStageInstance.programStage.program.type!='1')
			hideById('newEncounterBtn');
		#end
		#if($!programStageInstance.programStage.id)
			setFieldValue('programStageId', "$!programStageInstance.programStage.id");
		#end
		#if( $programStageInstance )
			setFieldValue( 'dueDate', "$!format.formatDate( $programStageInstance.dueDate )" );
			setFieldValue( 'executionDate', "$!format.formatDate( $programStageInstance.executionDate )" );
		#end
		
		entryFormContainerOnReady();
		
	});
</script>

<div id='entryFormContainer'>

<input type='hidden' id='incidentDate' value='$!format.formatDate($programStageInstance.programInstance.dateOfIncident)'>
<input type='hidden' name='programStageInstanceId' id='programStageInstanceId' value='$!programStageInstance.id'>
<input type='hidden' name='programInstanceId' id='programInstanceId' value='$!programStageInstance.programInstance.id'>
<input type='hidden' name='irregular' id='irregular' value='$!programStageInstance.programStage.irregular'>
<input type='hidden' name='displayGenerateEventBox' id='displayGenerateEventBox' value='$!programStageInstance.programStage.displayGenerateEventBox'>
<input type='hidden' name='completed' id='completed' value='$!programStageInstance.completed'>
<input type='hidden' name='programStageUid' id='programStageUid' value='$!programStageInstance.programStage.uid'>
<input type='hidden' name='programId' id='programId' value='$!programStageInstance.programInstance.program.id'>
<input type='hidden' name='validCompleteOnly' id='validCompleteOnly' value='$!programStageInstance.programStage.validCompleteOnly'>
<input type='hidden' name='currentUsername' id='currentUsername' value='$!currentUsername'>
<input type='hidden' name='blockEntryForm' id='blockEntryForm'  value='$!programStageInstance.programInstance.program.blockEntryForm'>

<div id='entryForm' #if($!programStageInstance.executionDate) class='visible' #else class='hidden' #end>					
	<table style="width:600px;margin-top:-9px" class="listTable">
		#if($programStageInstance.programStage.captureCoordinates=='true')
		<tr>
			<th class='coordinates1'><label for="longitude">$i18n.getString( "longitude" )</label></th>
			<th class='coordinates2'><input type="text" class='criteria' id="longitude" name="longitude" value="$!{longitude}" class="{validate:{number:true,min:-180,max:180}}" placeholder='$i18n.getString("enter_a_number")' ></th>
			<th class='coordinates1'><label for="latitude">&nbsp;$i18n.getString( "latitude" )</label></th>
			<th class='coordinates2'>
				<input type="text" class='criteria' id="latitude" name="latitude" value="$!{latitude}" class="{validate:{number:true,min:-90,max:90}}" placeholder='$i18n.getString("enter_a_number")' >
				<img style='cursor:pointer' src='images/save.png' title='$i18n.getString("save")' onclick='saveCoordinatesEvent($!programStageInstance.id);' />
			</th>
		</tr>
		#end
		<tr>
			<th class='coordinates1'><label for="postComment">$i18n.getString('post_comment'):</label></td>
			<th colspan='3'>
				<input type="text" class="{validate:{maxlength:160}} criteria" name="comment_$programStageInstance.id" id="comment_$programStageInstance.id" style="width:430px;#if($programStageInstance.programStage.captureCoordinates=='false') margin-left:10px; #end " onkeypress="keypressOnComent(event,this,$programStageInstance.id);">
			</td>
		</tr>
		
		<tr>
			<td class='coordinates1'></td>
			<td colspan='3'>
				<table>
					<tbody id="commentTB">
						#foreach( $comment in $programStageInstance.patientComments )
						<tr>
							<td>$format.formatDateTime($comment.createdDate) </td>
							<td>$comment.creator </td>
							<td>$!comment.commentText</td>
						</tr>
						#end
					</tbody>
				</table>
			</td>
		</tr>
	</table>
	</table>
	
	<br>
	
	#if( $customDataEntryFormCode )
		#parse( "/dhis-web-caseentry/customDataEntryForm.vm" )
	#elseif( $sections && $sections.size() > 0 )
		#parse( "/dhis-web-caseentry/sectionDataEntryForm.vm" )
	#else
		#parse( "/dhis-web-caseentry/defaultDataEntryForm.vm" )
	#end
</div>

<div id='inputCriteriaDiv' class="page inputCriteria #if($programStageInstance.executionDate) #else hidden #end " style="width:490px;height:29px;">	
	<input type="button" class='button' id="completeBtn" value="$i18n.getString('complete')" onClick="doComplete()" disabled="disabled">
	<input type="button" id="uncompleteBtn" value="$i18n.getString('incomplete')" onclick="doUnComplete()" disabled="disabled">
	<input type="button" class='button' id="validationBtn" value="$i18n.getString('run_validation')" onClick="javascript: runValidation();" disabled="disabled">
</div>

</div>

<div id="loading-bar" class="hidden" align='center'>
	<p>Validation rules are being processed, please wait ...<br>
	<img src='../images/ajax-loader-circle.gif'></p>
</div>

<div id='validateProgramDiv'></div>

<script>
	var i18n_create_new_event = '$encoder.jsEscape( $i18n.getString( "create_new_event" ) , "'" )';
	var i18n_enter_a_value_less_than_or_equal_to_180 = '$encoder.jsEscape( $i18n.getString( "enter_a_value_less_than_or_equal_to_180" ) , "'" )';
	var i18n_enter_a_value_greater_than_or_equal_to_nagetive_180 = '$encoder.jsEscape( $i18n.getString( "enter_a_value_greater_than_or_equal_to_nagetive_180" ) , "'" )';
	var i18n_enter_a_value_less_than_or_equal_to_90 = '$encoder.jsEscape( $i18n.getString( "enter_a_value_less_than_or_equal_to_90" ) , "'" )';
	var i18n_enter_a_value_greater_than_or_equal_to_nagetive_90 = '$encoder.jsEscape( $i18n.getString( "enter_a_value_greater_than_or_equal_to_nagetive_90" ) , "'" )';
	var i18n_enter_values_for_longitude_and_latitude_fields = '$encoder.jsEscape( $i18n.getString( "enter_values_for_longitude_and_latitude_fields" ) , "'" )';
	var i18n_enter_a_valid_number = '$encoder.jsEscape( $i18n.getString( "enter_a_valid_number" ) , "'" )';
	
	#if( $programStageInstance.programInstance.program.type=='1' && $programStageInstance.programInstance.completed=="true")
		jQuery("[id=entryFormContainer] :input").prop('disabled', true);
		jQuery("[id=entryFormContainer] :input").datepicker("destroy");
		jQuery("[id=executionDate]").prop('disabled', true);
		jQuery("[id=executionDate]").datepicker("destroy");
	#end

	if(getFieldValue('completed')=='true' && getFieldValue('blockEntryForm')=='true'){
		blockEntryForm();
	}
</script>

