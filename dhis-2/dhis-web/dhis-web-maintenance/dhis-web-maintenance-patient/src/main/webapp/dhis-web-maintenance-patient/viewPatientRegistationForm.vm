<script type="text/javascript">
  
	jQuery(document).ready(	function()
	{
		validation( 'saveDataEntryForm', function( form )
		{
			setInnerHTML( 'designTextarea' , jQuery("#designTextarea").ckeditorGet().getData() );
			form.submit();
		} );

		jQuery('#designTextarea').ckeditor();
		#if($!registrationForm)
			jQuery("#designTextarea").ckeditorGet().setData('$encoder.jsEscape( $!registrationForm.dataEntryForm.htmlCode, "'" )');
		#end
		
		checkValueIsExist( "name", "validateDataEntryForm.action", { dataEntryFormId: '$!registrationForm.dataEntryForm.id' } );
	});

    var i18n_dataelement_is_inserted = '$encoder.jsEscape( $i18n.getString( "dataelement_is_inserted" ) , "'" )';
	var i18n_specify_dataelememt = '$encoder.jsEscape( $i18n.getString( "specify_dataelememt" ) , "'" )';
    var i18n_choose_existing_dataentry ='$encoder.jsEscape( $i18n.getString( "choose_existing_dataentry" ) , "'" )';
	var i18n_dataelement = "$i18n.getString( 'dataelement' )";
	var i18n_dataelement_of_orther_program_stage = "$i18n.getString( 'dataelement_of_orther_program_stage' )";
	
	var previousName = '';
</script>

<style type="text/css">
.ui-state-active2, .ui-widget-content .ui-state-active2, .ui-widget-header .ui-state-active2 {
	border: 1px solid #79b7e7;
	background: #f5f8f9;
	font-weight: bold;
	color: #e17009;
}

.ui-dialog .ui-dialog-content {
	padding: 2px;
}

#fixedAttrSelector, #identifiersSelector, #attributesSelector,  {
	padding: 2px;
}
</style>

<form id="saveDataEntryForm" name="saveDataEntryForm" action="savePatientRegistrationForm.action" method="post">

<input type="hidden" name="id" id="id" value="$!registrationForm.id"/>
<input type="hidden" name="programId" id="programId" value="$!programId"/>
<input type="hidden" name="dataEntryFormId" id="dataEntryFormId" value="$!registrationForm.dataEntryForm.id"/>

<h3>$i18n.getString( "add_patient_registration_form" )</h3>
<div class="container" >
	<table id="detailsList" width="100%">
		<col/>
		<tr>
			<th colspan='3'>$i18n.getString( "patient_registration_details" )</th>
		</tr>
		<tr>
			<td>
				<label>$i18n.getString( "name" ) <em title="$i18n.getString( "required" )" class="required">*</em></label>
			</td>
			<td>
				<input type="text" id="name" value="$!registrationForm.dataEntryForm.name" name="name" class="{validate:{required:true,rangelength:[4,150],alphanumericwithbasicpuncspaces:true,firstletteralphabet:false}}" style="width:30em;">
			</td>	
			<td align="right">
				<input type="button" value="$i18n.getString( 'properties' )" onclick="openPropertiesSelector()"/><br>
			</td>			
		</tr>
		<tr>
			<td>&nbsp;</td>
		</tr>		
	</table>  
	
	<table width="100%">
		<tr>
			<th>$i18n.getString( "design_patient_registration_form" )</th>
		</tr>
		<tr>
			<td>
	        	<div>
	        		<textarea id="designTextarea" name="designTextarea"></textarea>
	        	</div>
			</td>
		</tr>
	</table>
</div>

<table width="100%">	
    <tr>
        <td>
            <input type="submit" name="save" value="$i18n.getString( 'save' )" style="width:120px"/>
            <input type="button" name="cancel" value="$i18n.getString( 'cancel' )" style="width:120px" onclick="window.location='patientRegistrationForm.action'">            
			#if( $!registationForm.dataEntryForm )
			<input type="button" name="delete" value="$i18n.getString( 'delete' )" style="width:120px" onclick="deleteDataEntryForm( $registrationForm.id )" />
			#end
        </td>		
    </tr>
</table>
  
</form>

<div id='selectionDialog' class='hidden'>
	<table id="fixedAttrTab" class='hidden'>
		<tr>
			<td>
				<input type='text' placeholder="$i18n.getString('filter')" style="width:278px;">
				<input type='button' value="$i18n.getString('filter')" style="width:80px;">
				<input type='button' value="$i18n.getString('clear')" style="width:80px;">
			</td>
		</tr>
		<tr>
			<td>
				<select id="fixedAttrSelector" multiple="multiple" style="width:450px;height:270px" ondblclick="insertElement( 'fixedAttr' )">
					<option value="fullName">$i18n.getString('full_name')</option>
					<option value="gender">$i18n.getString('gender')</option>
					<option value="birthDate">$i18n.getString('birth_date')</option>
					<option value="phoneNumber">$i18n.getString('phone_number')</option>
					<option value="deathDate">$i18n.getString('death_date')</option>
					<option value="registrationDate">$i18n.getString('registration_date')</option>
					<option value="isDead">$i18n.getString('is_dead')</option>
					<option value="dobType">$i18n.getString('dob_type')</option>
					<option value="healthWorker">$i18n.getString('health_worker')</option>
				</select>
			</td>
		</tr>
	</table>
	
	<table id="identifierTypeTab" class='hidden'>
		<tr>
			<td>
				<input type='text' placeholder="$i18n.getString('filter')" style="width:278px;">
				<input type='button' value="$i18n.getString('filter')" style="width:80px;">
				<input type='button' value="$i18n.getString('clear')" style="width:80px;">
			</td>
		</tr>
		<tr>
			<td>
				<select id="identifiersSelector" multiple="multiple" style="width:450px;height:270px" ondblclick="insertElement( 'iden' )">
					#foreach( $identifierType in $identifierTypes )
						<option value="$identifierType.id">$encoder.htmlEncode($identifierType.displayName)</option>
					#end
				</select>
			</td>
		</tr>
	</table>
	
	<table id="attributeTab" class='hidden'>
		<tr>
			<td>
				<input type='text' placeholder="$i18n.getString('filter')" style="width:278px;">
				<input type='button' value="$i18n.getString('filter')" style="width:80px;">
				<input type='button' value="$i18n.getString('clear')" style="width:80px;">
			</td>
		</tr>
		<tr>
			<td>
				<select id="attributesSelector" multiple="multiple" style="width:450px;height:270px" ondblclick="insertElement( 'attr' )">
				#foreach( $attribute in $attributes )
					<option value="$attribute.id">$encoder.htmlEncode($attribute.displayName)</option>
				#end
				</select>
			</td>
		</tr>
	</table>
	
	<table id="programAttrTab" class='hidden'>
		<tr>
			<td>
				<input type='text' placeholder="$i18n.getString('filter')" style="width:278px;">
				<input type='button' value="$i18n.getString('filter')" style="width:80px;">
				<input type='button' value="$i18n.getString('clear')" style="width:80px;">
			</td>
		</tr>
		<tr>
			<td>
				<select id="programAttrSelector" multiple="multiple" style="width:450px;height:270px" ondblclick="insertElement( 'prg' )">
					<option value="enrollmentDate">$encoder.htmlEncode($program.dateOfEnrollmentDescription)</option>
					#if($program.displayIncidentDate=='true')
					<option value="dateOfIncident">$encoder.htmlEncode($program.dateOfIncidentDescription)</option>
					#end
				</select>
			</td>
		</tr>
	</table>
	
	<table>
		<tr>
			<td>
				<button type="button" id="fixAttrButton" onclick="fixAttrOnClick()">$i18n.getString( "fixed_attributes" )</button>
				<button type="button" id="identifierTypeButton" onclick="identifierTypeOnClick()">$i18n.getString( "identifier_types" )</button>
				<button type="button" id="attributesButton" onclick="attributesOnClick()">$i18n.getString( "attributes" )</button>
				<button type="button" id="programAttrButton" onclick="programAttrOnClick()">$i18n.getString( "program" )</button>
			</td>
		</tr>
	</table>
</div>

<script>
	var i18n_delete_program_data_entry_confirm = '$encoder.jsEscape( $i18n.getString( "delete_program_data_entry_confirm" ) , "'" )';
</script>
